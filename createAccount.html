<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix - Login Page</title>
    <link rel="icon" href="src/imagens/MatrixImagens/MatrixPoster.jpg" type="image/jpg">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/reset.css">
    <link rel="stylesheet" href="src/styles/style.css">
    <link rel="stylesheet" href="src/styles/styleNav.css">
    <!-- <link rel="stylesheet" href="src/styles/styleFooter.css"> -->
    <link rel="stylesheet" href="src/styles/styleCreateAccount.css">

    <!-- Scripts -->
    <script src="src/scripts/validaForm.js"></script>
    

</head>
<body>
    <header class="header">
      <nav class="navbar fixed-top navbar-expand-lg ">
        <div class="container-fluid  gap-2">
          <button class="navbar-toggler navbar-toggler-custom order-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon" ></span>
          </button>
          <a class="navbar-brand order-2 mx-auto" href="index.html">
            <img src="src/imagens/JLImagens/LogoWideOriginal.jpg" class="logo" width="173" height="30" alt="LOGO - JL TELHAS E FERRAGENS">
          </a>
          <a class="navbar-brand order-4 active" id="color-picker" aria-current="page" href="createAccount.html">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon_menu-person" width="25" height="25" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
              <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
            </svg>
          </a>
          <a class="navbar-brand order-5 disabled" id="color-picker" href="#">
            <svg xmlns="http://w3.org/2000/svg" class="icon_menu-cart" width="22" height="22" fill="currentColor" class="bi bi-cart-fill" viewBox="0 0 16 16">
                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
          </a>
          <div class="collapse navbar-collapse order-3" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" id="color-picker" href="index.html">Home</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="color-picker" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Produtos
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" id="color-picker" href="produtos/churrasqueiras.html">Churrasqueiras</a></li>
                    <li><a class="dropdown-item" id="color-picker" href="#">Telhas</a></li>
                    <li><a class="dropdown-item" id="color-picker" href="#">Fogões</a></li>
                    <li><a class="dropdown-item" id="color-picker" href="#">Tubos e Conexões</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item disabled" id="color-picker" href="#">Outros</a></li>
                  </ul>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="color-picker" href="#">Sobre Nós</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="color-picker" href="#">Contato</a>
                </li>
            </div>
            <form class="d-flex mr-left ms-2" role="search" id="barra-de-pesquisa">
              <input class="form-control me-2 col-12" id="color-input-picker" type="search" placeholder="Pesquisar" aria-label="Search">
              <button class="btn btn-outline-success" id="color-button-picker" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
              </button>
            </form>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div id="message-container" class="alert alert-success d-none" role="alert">
        Conta criada com sucesso!
      </div>
      <form name="SignUp" id="form-create-account">
        <h2>Create Account</h2>
        <div class="form-group">
          <label for="InputLogin">Crie um Login</label>
          <input type="text" class="form-control" id="InputLogin" aria-describedby="LoginHelp" placeholder="Seu login">
          <span id="spanLogin" class="span_SignUp"></span>
        </div>
        <div class="form-group">
          <label for="InputPassword">Crie um Senha</label>
          <input type="password" class="form-control" id="InputPassword" placeholder="Senha">
          <span id="spanPassword" class="span_SignUp"></span>
        </div>
        <div class="form-group hidden"></div>
          <span id="spanError" class="span_SignUp"></span>
        </div>
        <button type="submit" class="btn btn-primary">Enviar</button>
      </form>


      <script>
        document.getElementById('form-create-account').addEventListener('submit', async (e) => {
          e.preventDefault();  

          let formValido = true;
        
          const user_login_input = document.getElementById('InputLogin');
          const user_senha_input = document.getElementById('InputPassword');

          const user_login = user_login_input.value;
          const user_senha = user_senha_input.value;

          const spanLogin = document.getElementById('spanLogin');
          const spanPassword = document.getElementById('spanPassword');
          const spanError = document.getElementById('spanError');
          const divSpanError = spanError.parentElement;  

          spanLogin.textContent = "";
          spanPassword.textContent = "";

          spanError.textContent = "";  
          divSpanError.classList.add('hidden');
        
          // Valida form
          if (user_login === "") {
              spanLogin.textContent = 'Usuário deve ser preenchido com o nome do usuário do sistema';
              formValido = false;
              user_login_input.classList.add("inputDestacado");
          }
          else{
              user_login_input.classList.remove("inputDestacado");
          }

          if(user_senha === ""){
              spanPassword.textContent = 'Uma senha deve ser fornecida';
              formValido = false;
              user_senha_input.classList.add("inputDestacado");
          }else if(user_senha.indexOf(' ')>=0){
              spanPassword.textContent = 'A senha não deve ter espaços em branco';
              formValido = false;
              user_senha_input.classList.add("inputDestacado");
          }else if(user_senha.length < 8){
              spanPassword.textContent = 'A senha deve conter pelo menos 8 caracteres';
              formValido = false;
              user_senha_input.classList.add("inputDestacado");
          }else{
              user_senha_input.classList.remove("inputDestacado");
          }

          if (formValido){
            try {
              const response = await fetch('http://localhost:3000/createAccount', { //fetch() utilizado para fazer uma requisição HTTP
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json', //indica que o corpo da requisição está em formato JSON.
                },
                body: JSON.stringify({ user_login, user_senha }),  // Envia os dados no corpo da requisição
              });
              
              const data = await response.text();  
          
              if (response.ok) { // True: geralmente com códigos de status HTTP entre 200 e 299. False: significa que algo deu errado (códigos de erro HTTP como 400 ou 500).
                const messageContainer = document.getElementById('message-container');
                messageContainer.classList.remove('d-none');
                messageContainer.textContent = 'Conta criada com sucesso!';

                const form_desaparecer = document.getElementById('form-create-account')
                form_desaparecer.classList.add('d-none');

                // Redirecionar para outra página depois de alguns segundos
                setTimeout(() => {
                  window.location.href = 'login.html'; 
                }, 2000); // 2 segundos antes do redirecionamento
              } else {
                spanError.textContent = 'Erro ao criar conta: ' + data;
                divSpanError.classList.remove('hidden');
              }
            } catch (error) {
              spanError.textContent = 'Erro ao criar conta. Tente novamente mais tarde.';
              divSpanError.classList.remove('hidden');
              if (error.name === 'TypeError') {
                console.error('Problema de conexão. Verifique se o servidor está rodando e se a URL está correta.', error);
              } else if (error.name === 'SyntaxError') {
                console.error('Erro ao interpretar a resposta do servidor. Verifique o formato do retorno.', error);
              } else {
                console.error('Erro inesperado: ' + error);
              }
            }
          }
          
        });
      </script>


    </main>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  </body>
</html>